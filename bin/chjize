#!/bin/bash

set -euo pipefail
IFS=

rulesdir=/opt/chj/chjize/rules

usage () {
    echo "$0 command [ args ]"
    echo "  run command from $rulesdir with proper env"
    exit 1
}

command=$1
shift


if [ "$(readlink -f "$0")" != "$(readlink -f /opt/chj/chjize/bin/chjize)" ]
then
    echo "wrong location: place this repository at /opt/chj/chjize/"
    exit 1
fi

source /opt/chj/chjize/bin/chj-env

set -x

"$rulesdir"/"$command" "$@"

# we're not guaranteed to be in /opt/chj/chjize, but..
touch "$command"
